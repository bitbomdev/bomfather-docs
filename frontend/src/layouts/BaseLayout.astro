---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import AnnouncementBanner from '../components/AnnouncementBanner.astro';

export interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <title>{title} | Bomfather</title>
    
    <!-- Preload fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&family=Manrope:wght@700;800&display=swap" rel="stylesheet">
    
    <!-- ConvertKit Form Script -->
    <script src="https://f.convertkit.com/ckjs/ck.5.js"></script>
  </head>
  <body class="bg-white text-dark">
    <AnnouncementBanner />
    <Header />
    
    <main>
      <slot />
    </main>
    
    <!-- Newsletter Subscription Form -->
    <section class="bg-light-gray py-16">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-3xl md:text-4xl font-bold font-heading mb-4">Stay Informed on Supply Chain Security</h2>
        <p class="text-lg text-mid-gray max-w-2xl mx-auto mb-8">Get updates on Bomfather, eBPF innovations, and security best practices directly to your inbox.</p>
        
        <div class="max-w-md mx-auto">
          <div id="form-container">
            <form id="newsletter-form" action="https://app.convertkit.com/forms/7903890/subscriptions" method="post" class="bg-white p-6 rounded-lg shadow-sm">
              <div class="flex flex-col md:flex-row gap-4">
                <input 
                  type="email" 
                  name="email_address" 
                  placeholder="Your email address" 
                  required 
                  class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
                <button 
                  type="submit"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-8 py-3 rounded-lg transition-colors"
                >
                  Subscribe
                </button>
              </div>
            </form>
          </div>
          
          <!-- Simple text-only success message -->
          <div id="success-message" class="hidden bg-white p-6 rounded-lg shadow-sm">
            <p class="text-dark font-medium">Thank you for signing up!</p>
            <p class="text-mid-gray text-sm mt-2">We've sent a confirmation email to your inbox.</p>
          </div>
        </div>
      </div>
    </section>
    
    <Footer />
    
    <!-- JavaScript for form handling -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('newsletter-form');
        const formContainer = document.getElementById('form-container');
        const successMessage = document.getElementById('success-message');
        
        if (form) {
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = form.querySelector('input[name="email_address"]').value;
            
            try {
              // Submit form data to ConvertKit
              const response = await fetch(form.action, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `email_address=${encodeURIComponent(email)}`,
              });
              
              // Show our custom success message
              formContainer.classList.add('hidden');
              successMessage.classList.remove('hidden');
              
            } catch (error) {
              console.error('Error submitting form:', error);
              // Still show success message
              formContainer.classList.add('hidden');
              successMessage.classList.remove('hidden');
            }
          });
        }
      });
    </script>
  </body>
</html> 